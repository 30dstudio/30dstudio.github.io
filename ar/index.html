<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.5/dist/mindar-image.prod.js"></script>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.5/dist/mindar-image-aframe.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
  <title>30D Studio</title>
</head>
<body>
  <script language="javascript">
      let angle = 0;
      let pointer;
      let hasHeading = false;

      var myArray = [0, 15, 13, 11, -11, -6, -14, -7, 6, 8]; 
      function getFakeHeading() {
        return myArray[(Math.random() * myArray.length) | 0];
      }

      if (navigator.geolocation) {
        const successCallback = (position) => {
          const heading = position.coords.heading;
          if (heading) {
            angle = heading;
            hasHeading = true;
          } else {
            angle = getFakeHeading();
          }
          document.querySelector('.panel').innerHTML = "Heading: " + heading;
        };

        const errorCallback = (error) => {
          console.log(error);
        };
        navigator.geolocation.watchPosition(successCallback, errorCallback);
      }

      function rotate() {
        angle = getFakeHeading();

        // window.el.setAttribute('rotation', {z: angle});
        // window.requestAnimationFrame(rotate);
      }
      
      AFRAME.registerComponent('compass-pointer',{
        scene: {},
        init: function() {
          console.log(this.el.sceneEl);
          this.scene = this.el.sceneEl;
          pointer = document.querySelector('#compass');
          window.el = pointer;
          rotate(pointer);
        }
      });
    </script>
  <a-scene mindar-image="imageTargetSrc: https://30dstudio.github.io/assets/trinta.mind;" color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
      <a-assets>
	      <img id="card" src="https://30dstudio.github.io/assets/logo-30d.png" crossorigin="anonymous"/>
	      <a-asset-item id="avatarModel" src="https://30dstudio.github.io/assets/nautilus/scene.gltf"></a-asset-item>
	      <a-asset-item id="compassModel" src="https://30dstudio.github.io/assets/compass-body.gltf"></a-asset-item>
	      <a-asset-item id="pointerModel" src="https://30dstudio.github.io/assets/pointer.gltf"></a-asset-item>
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <a-entity mindar-image-target="targetIndex: 0">
        <a-gltf-model rotation="0 0 0" position="0 0 0.6" scale="0.7 0.7 0.7" src="#compassModel" animation-mixer></a-gltf-model>
        <a-gltf-model rotation="0 0 0" position="0 0 0.7" scale="0.7 0.7 0.7" src="#pointerModel" compass-pointer id="compass"></a-gltf-model>
      </a-entity>
    </a-scene>
</body>
</html>