<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.5/dist/mindar-image.prod.js"></script>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.5/dist/mindar-image-aframe.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
  <title>30D Studio</title>
  <style>
    .panel {
      position: fixed;
      bottom: 0;
      height: 30px;
      z-index: 9999;
      background: white;
      color: black;
      font-size: 24px;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }
  </style>
</head>
<body>
  <div class="panel"></div>
  <script language="javascript">
      let angle = 0;
      let pointer;

      if (navigator.geolocation) {
        const successCallback = (position) => {
          console.log('position: ', position);
          const heading = position.coords.heading;
          document.querySelector('.panel').innerHTML = "Heading: " + heading;
          angle = heading;
        };

        const errorCallback = (error) => {
          console.log(error);
        };
        navigator.geolocation.watchPosition(successCallback, errorCallback);
      }
      
      AFRAME.registerComponent('compass-pointer',{
        scene: {},
        init: function() {
          console.log(this.el.sceneEl);
          this.scene = this.el.sceneEl;
          pointer = document.querySelector('#compass');
          // document.addEventListener('click', this.OnDocumentMouseDown);
        },
        tick: function() {
          // console.log('tick');
          // angle += 2;
          // pointer.setAttribute('rotation', {x: 90, y: 180, z: 0});
          pointer.setAttribute('rotation', {z: angle });
        }
      });
    </script>
  <a-scene mindar-image="imageTargetSrc: http://127.0.0.1:5500//assets/trinta.mind;" color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
      <a-assets>
	      <img id="card" src="http://127.0.0.1:5500//assets/logo-30d.png" crossorigin="anonymous"/>
	      <a-asset-item id="avatarModel" src="http://127.0.0.1:5500//assets/nautilus/scene.gltf"></a-asset-item>
	      <!-- <a-asset-item id="compassPointer" src="http://127.0.0.1:5500//assets/compass-pointer.gltf"></a-asset-item> -->
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <a-entity mindar-image-target="targetIndex: 0">
        <a-cylinder height="0.4" radius="0.1" position="0 0 0.7" material="opacity: 0.0; transparent: true" compass-pointer id="compass">
          <a-cone color="red" position="0 0.1 0" radius-bottom="0.02" radius-top="0.001" height="0.2" pointer-component></a-cone>
          <a-cone color="white" position="0 -0.1 0" rotation="0 0 180" radius-bottom="0.02" radius-top="0.001" height="0.2"></a-cone>
        </a-cylinder>
        <a-gltf-model rotation="0 0 0" position="-0.5 0 0.5" scale="0.01 0.01 0.01" src="#avatarModel" animation-mixer></a-gltf-model>
        <!-- <a-gltf-model rotation="90 180 0" position="0 0.2 0.6" scale="0.04 0.04 0.04" src="#compassPointer" compass-pointer id="compass"></a-gltf-model> -->
      </a-entity>
    </a-scene>
</body>
</html>